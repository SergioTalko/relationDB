SELECT
  SALESMAN.NAME,
  CUSTOMER.CUSTNAME
FROM SALESMAN
  JOIN CUSTOMER ON SALESMAN.SALESMAN_ID = CUSTOMER.SALESMAN_ID;

SELECT
  SALESMAN.NAME     AS "ManagerName",
  SALESMAN.CITY,
  CUSTOMER.CUSTNAME AS "CustomerName"
FROM SALESMAN, CUSTOMER
WHERE SALESMAN.CITY = CUSTOMER.CITY;

SELECT
  SALESMAN.NAME     AS "ManagerName",
  SALESMAN.CITY,
  CUSTOMER.CUSTNAME AS "CustomerName"
FROM SALESMAN
  JOIN CUSTOMER ON SALESMAN.CITY = CUSTOMER.CITY;

--1
SELECT
  CUSTOMER.CUSTNAME AS "ClientName",
  CUSTOMER.CITY     AS "ClientCity",
  SALESMAN.NAME     AS "ManagerName",
  SALESMAN.CITY     AS "ManagerCity",
  DEALS.AMOUNT      AS "DealAmount"
FROM CUSTOMER
  INNER JOIN SALESMAN ON CUSTOMER.SALESMAN_ID = SALESMAN.SALESMAN_ID

  INNER
  JOIN DEALS ON CUSTOMER.CUSTOMER_ID = DEALS.CUSTOMER_ID
WHERE DEALS.AMOUNT > 10000;

--2
SELECT
  CUSTOMER.CUSTNAME    AS "CustomerDoneDeals2017-2018",
  COUNT(DEALS.DEAL_ID) AS "CountOfDeals"
FROM CUSTOMER
  INNER JOIN DEALS ON CUSTOMER.CUSTOMER_ID = DEALS.CUSTOMER_ID
WHERE EXTRACT(YEAR FROM DEALS.DEAL_DATE) BETWEEN 2017 AND 2018
GROUP BY CUSTOMER.CUSTNAME;

--3


SELECT
  SALESMAN.NAME     AS "BestManager",
  SUM(DEALS.AMOUNT) AS "SumDeals"
FROM SALESMAN
  INNER JOIN CUSTOMER ON SALESMAN.SALESMAN_ID = CUSTOMER.SALESMAN_ID
  INNER JOIN DEALS ON CUSTOMER.CUSTOMER_ID = DEALS.CUSTOMER_ID
WHERE TO_CHAR(DEAL_DATE, 'MM-YYYY') = '08-2017'
GROUP BY SALESMAN.NAME
ORDER BY "SumDeals" DESC;

---------------------------------------------------------

--TABLE WITH SALESMAN AND SUM OF DEALS 08-2017
WITH sum_of_deals AS (
    SELECT
      SALESMAN.NAME     AS "BestManager",
      SUM(DEALS.AMOUNT) AS "SumDeals"
    FROM SALESMAN
      INNER JOIN CUSTOMER ON SALESMAN.SALESMAN_ID = CUSTOMER.SALESMAN_ID
      INNER JOIN DEALS ON CUSTOMER.CUSTOMER_ID = DEALS.CUSTOMER_ID
    WHERE TO_CHAR(DEAL_DATE, 'MM-YYYY') = '08-2017'
    GROUP BY SALESMAN.NAME),
  --MAX SUM OF DEALS
    max_sum AS (

      SELECT MAX("SumDeals") AS "Max_Sum"
      FROM sum_of_deals
  )
  --SELECT ALL MAX VALUES(CASE IF 2 OR MORE SAME SUMS)
  SELECT * FROM sum_of_deals WHERE "SumDeals" = (SELECT * FROM max_sum);


